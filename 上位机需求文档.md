# STM32F407 ä¸Šä½æœºç¨‹åºéœ€æ±‚æ–‡æ¡£

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

**é¡¹ç›®åç§°**: STM32F407 æ¸©åº¦æ§åˆ¶ç³»ç»Ÿæ•°æ®é‡‡é›†ä¸Šä½æœº  
**STM32ç«¯**: å®æ—¶é‡‡é›†ä¼ æ„Ÿå™¨æ•°æ®å¹¶é€šè¿‡ä¸²å£å‘é€  
**ä¸Šä½æœºç«¯**: æ¥æ”¶ã€è§£æã€å­˜å‚¨å’Œæ˜¾ç¤ºæ•°æ®  
**é€šä¿¡æ–¹å¼**: UARTä¸²å£é€šä¿¡  

---

## ğŸ”Œ ç¡¬ä»¶é€šä¿¡å‚æ•°

| å‚æ•° | å€¼ |
|------|-----|
| **ä¸²å£å·** | USART2 (éœ€æ ¹æ®å®é™…è¿æ¥ç¡®å®šCOMå£) |
| **æ³¢ç‰¹ç‡** | 115200 |
| **æ•°æ®ä½** | 8 |
| **åœæ­¢ä½** | 1 |
| **æ ¡éªŒä½** | æ—  (NONE) |
| **æµæ§** | æ—  |

---

## ğŸ“¨ æ•°æ®æ ¼å¼è¯´æ˜

### 1. JSONæ ¼å¼æ•°æ® (ä¼ æ„Ÿå™¨æ•°æ®)

STM32æ¯**500ms**å‘é€ä¸€ç»„æ•°æ®ï¼Œå…±3æ¡JSONæ¶ˆæ¯ï¼š

#### æ¶ˆæ¯1: WF5803æ¸©åº¦å’Œæ°”å‹ä¼ æ„Ÿå™¨
```json
{"type":"data","sensor":"WF5803","temp":26.30,"press":101.25}
```
- `type`: å›ºå®šä¸º `"data"` (æ•°æ®ç±»å‹)
- `sensor`: å›ºå®šä¸º `"WF5803"` (ä¼ æ„Ÿå™¨åç§°)
- `temp`: æµ®ç‚¹æ•°ï¼Œæ¸©åº¦å€¼ (å•ä½: Â°C)
- `press`: æµ®ç‚¹æ•°ï¼Œæ°”å‹å€¼ (å•ä½: kPa)

#### æ¶ˆæ¯2: NTCæ¸©åº¦ä¼ æ„Ÿå™¨ â­ **é‡ç‚¹æ•°æ®**
```json
{"type":"data","sensor":"NTC","temp":25.60}
```
- `type`: å›ºå®šä¸º `"data"`
- `sensor`: å›ºå®šä¸º `"NTC"` (ç›®æ ‡ä¼ æ„Ÿå™¨)
- `temp`: æµ®ç‚¹æ•°ï¼ŒNTCæ¸©åº¦å€¼ (å•ä½: Â°C)

#### æ¶ˆæ¯3: PIDæ§åˆ¶å™¨è¾“å‡º
```json
{"type":"data","sensor":"PID","output":45.20}
```
- `type`: å›ºå®šä¸º `"data"`
- `sensor`: å›ºå®šä¸º `"PID"`
- `output`: æµ®ç‚¹æ•°ï¼ŒPIDæ§åˆ¶è¾“å‡ºå€¼ (èŒƒå›´: 0-100)

### 2. æ™®é€šæ–‡æœ¬æ¶ˆæ¯ (ç³»ç»Ÿä¿¡æ¯)

#### ç³»ç»Ÿå¯åŠ¨ä¿¡æ¯
```
=== Sensors_and_compute Task Started! ===
=== Voltage Monitor Task Started (Priority: Low) ===
=== USART Receive Task Started (Priority: Realtime) ===
Check interval: 600000 ms (10.0 minutes)
========================================
```

#### ç”µå‹ç›‘æ§ä¿¡æ¯
```
[PERIODIC] Voltage check...
Voltage: 12.50V
```

#### è­¦å‘Šä¿¡æ¯
```
!!! LOW VOLTAGE ALERT !!!
Suspending All tasks...
Sensors_and_compute task suspended due to low voltage!
```

#### è°ƒè¯•ä¿¡æ¯
```
Received byte from USART2: '1' (0x31)
Target temperature set to 50.00Â°C
Target temperature already at 60.00Â°C
Kp value increased to 11.00
```

---

## ğŸ¯ ä¸Šä½æœºæ ¸å¿ƒåŠŸèƒ½éœ€æ±‚

### åŠŸèƒ½1: ä¸²å£æ•°æ®æ¥æ”¶ âœ…

**éœ€æ±‚æè¿°**:
- å®æ—¶æ¥æ”¶STM32å‘é€çš„æ‰€æœ‰æ•°æ®
- è‡ªåŠ¨è¯†åˆ«JSONæ ¼å¼å’Œæ™®é€šæ–‡æœ¬æ ¼å¼
- å¤„ç†ä¸­æ–‡å’Œç‰¹æ®Šå­—ç¬¦ (ä½¿ç”¨UTF-8ç¼–ç )
-èƒ½é€šè¿‡æ–‡ä»¶ä¿®æ”¹ä¸²å£å·å’Œæ³¢ç‰¹ç‡ç­‰ç›¸å…³ä¿¡æ¯

**æŠ€æœ¯è¦ç‚¹**:
```python
ser = serial.Serial('COM3', 115200, timeout=1)
line = ser.readline().decode('utf-8', errors='ignore').strip()
```

---

### åŠŸèƒ½2: æ¶ˆæ¯åˆ†ç±»å¤„ç† âœ…

**éœ€æ±‚æè¿°**:
- JSONæ¶ˆæ¯: è§£æå¹¶ä¿å­˜æ•°æ®
- æ™®é€šæ–‡æœ¬: å®æ—¶æ‰“å°åˆ°æ§åˆ¶å°

**è¯†åˆ«é€»è¾‘**:
```python
if line.startswith('{') and line.endswith('}'):
    # JSONæ¶ˆæ¯ - è§£æå¤„ç†
    data = json.loads(line)
    if data['type'] == 'data':
        process_sensor_data(data)
else:
    # æ™®é€šæ–‡æœ¬ - æ‰“å°æ˜¾ç¤º
    print(line)
```

---

### åŠŸèƒ½3: NTCæ¸©åº¦æ•°æ®å­˜å‚¨ â­ **æ ¸å¿ƒéœ€æ±‚**

**éœ€æ±‚æè¿°**:
- åªè®°å½•NTCä¼ æ„Ÿå™¨çš„æ¸©åº¦æ•°æ®
- æ¯æ¬¡è¿è¡Œåˆ›å»ºæ–°æ–‡ä»¶ (ä¸è¦†ç›–å†å²æ•°æ®)
- æ·»åŠ ä¸Šä½æœºæ—¶é—´æˆ³ (ä¸»æœºæ—¶é—´)
- æ”¯æŒåç»­ç”»å›¾åˆ†æ

**æ•°æ®ç»“æ„**:
```json
{
  "pc_timestamp": "2025-10-20T14:30:25.123456",  // ISOæ ¼å¼æ—¶é—´æˆ³
  "pc_time_sec": 1729412625.123456,              // Unixæ—¶é—´æˆ³(ç§’)
  "temperature": 25.60                            // NTCæ¸©åº¦(Â°C)
}
```

**æ–‡ä»¶å‘½åè§„åˆ™**:
- æ ¼å¼: `ntc_temp_YYYYMMDD_HHMMSS.json`
- ç¤ºä¾‹: `ntc_temp_20251020_143025.json`
- ä¿å­˜ç›®å½•: `./temp_data/` (è‡ªåŠ¨åˆ›å»º)

**æ–‡ä»¶æ ¼å¼**: JSONæ•°ç»„
```json
[
  {
    "pc_timestamp": "2025-10-20T14:30:25.123456",
    "pc_time_sec": 1729412625.123456,
    "temperature": 25.60
  },
  {
    "pc_timestamp": "2025-10-20T14:30:25.623789",
    "pc_time_sec": 1729412625.623789,
    "temperature": 25.61
  }
]
```

**æ•°æ®è¿‡æ»¤æ¡ä»¶**:
```python
if data['type'] == 'data' and data['sensor'] == 'NTC':
    # åªä¿å­˜NTCæ¸©åº¦æ•°æ®
    save_ntc_temperature(data['temp'])
```

---

### åŠŸèƒ½4: å®æ—¶æ•°æ®æ˜¾ç¤º âœ…

**éœ€æ±‚æè¿°**:
- æ§åˆ¶å°å®æ—¶æ˜¾ç¤ºæ¥æ”¶åˆ°çš„æ•°æ®
- åŒºåˆ†ä¸åŒç±»å‹çš„æ¶ˆæ¯ (ä¸åŒé¢œè‰²/æ ¼å¼)
- æ˜¾ç¤ºæ•°æ®è®¡æ•°

**æ˜¾ç¤ºæ ¼å¼ç¤ºä¾‹**:
```
ğŸ”Œ ä¸²å£ COM3 å·²æ‰“å¼€
ğŸ“Š æ•°æ®æ–‡ä»¶: ./temp_data/ntc_temp_20251020_143025.json
ğŸ“ æ—¥å¿—æ–‡ä»¶: ./temp_data/system_log_20251020_143025.txt
============================================================
ğŸ“ˆ [0001] 2025-10-20 14:30:25 | NTC Temp: 25.60Â°C
ğŸ“ˆ [0002] 2025-10-20 14:30:25 | NTC Temp: 25.61Â°C
ğŸ“ˆ [0003] 2025-10-20 14:30:26 | NTC Temp: 25.59Â°C
ğŸ’¬ === Voltage Monitor Task Started (Priority: Low) ===
ğŸ’¬ Check interval: 600000 ms (10.0 minutes)
```

---

### åŠŸèƒ½5: ç¨‹åºé€€å‡ºä¿å­˜ âœ…

**éœ€æ±‚æè¿°**:
- æŒ‰ `Ctrl+C` ä¼˜é›…é€€å‡º
- ä¿å­˜æ‰€æœ‰å·²æ¥æ”¶çš„æ•°æ®åˆ°æ–‡ä»¶
- æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯ (æ€»è®°å½•æ•°)
- å…³é—­ä¸²å£è¿æ¥

**é€€å‡ºæµç¨‹**:
1. æ•è· `KeyboardInterrupt` å¼‚å¸¸
2. ä¿å­˜æ•°æ®åˆ°JSONæ–‡ä»¶
3. æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯
4. å…³é—­ä¸²å£
5. é€€å‡ºç¨‹åº

**é€€å‡ºä¿¡æ¯ç¤ºä¾‹**:
```
â¹ï¸  è®°å½•åœæ­¢!
ğŸ“Š å…±è®°å½• 1250 æ¡NTCæ¸©åº¦æ•°æ®
âœ… æ•°æ®å·²ä¿å­˜: ./temp_data/ntc_temp_20251020_143025.json
âœ… ç³»ç»Ÿæ—¥å¿—å·²ä¿å­˜: ./temp_data/system_log_20251020_143025.txt
ğŸ”Œ ä¸²å£å·²å…³é—­
```

---

## ğŸ“Š æ•°æ®ç”¨é€”

### ç›®æ ‡: æ—¶é—´-æ¸©åº¦å…³ç³»åˆ†æ

**åˆ†æéœ€æ±‚**:
- ç»˜åˆ¶æ¸©åº¦éšæ—¶é—´å˜åŒ–æ›²çº¿
- åˆ†ææ¸©åº¦å˜åŒ–è¶‹åŠ¿
- è®¡ç®—æ¸©åº¦ç¨³å®šæ€§
- è¯„ä¼°PIDæ§åˆ¶æ•ˆæœ

**æ—¶é—´åŸºå‡†**: ä½¿ç”¨ä¸Šä½æœºæ—¶é—´æˆ³
- ç›¸å¯¹æ—¶é—´: `(å½“å‰æ—¶é—´ - èµ·å§‹æ—¶é—´).total_seconds()`
- ç”¨äºXè½´: æ—¶é—´é—´éš” (ç§’)
- ç”¨äºYè½´: æ¸©åº¦å€¼ (Â°C)

**ç»˜å›¾æ•°æ®æå–**:
```python
times = [(record['pc_time_sec'] - start_time) for record in data_list]
temps = [record['temperature'] for record in data_list]

plt.plot(times, temps)
plt.xlabel('æ—¶é—´ (ç§’)')
plt.ylabel('æ¸©åº¦ (Â°C)')
plt.title('NTCæ¸©åº¦å˜åŒ–æ›²çº¿')
```

---

## ğŸ”§ å¯é€‰åŠŸèƒ½ (å»ºè®®å®ç°)

### 1. ç³»ç»Ÿæ—¥å¿—è®°å½•
- è®°å½•æ‰€æœ‰éæ•°æ®ç±»æ¶ˆæ¯åˆ°æ—¥å¿—æ–‡ä»¶
- æ–‡ä»¶å‘½å: `system_log_YYYYMMDD_HHMMSS.txt`
- åŒ…å«: å¯åŠ¨ä¿¡æ¯ã€ç”µå‹ä¿¡æ¯ã€è­¦å‘Šã€è°ƒè¯•ä¿¡æ¯

### 2. å…¶ä»–ä¼ æ„Ÿå™¨æ•°æ®å­˜å‚¨
- WF5803æ¸©åº¦å’Œæ°”å‹æ•°æ®
- PIDè¾“å‡ºæ•°æ®
- å¯é€‰æ‹©æ€§ä¿å­˜æˆ–å¿½ç•¥

### 3. æ•°æ®å¯è§†åŒ–
- å®æ—¶ç»˜åˆ¶æ¸©åº¦æ›²çº¿ (matplotlibåŠ¨ç”»)
- å†å²æ•°æ®åˆ†æå·¥å…·
- å¤šä¼ æ„Ÿå™¨å¯¹æ¯”æ˜¾ç¤º

### 4. é”™è¯¯å¤„ç†
- ä¸²å£æ–­å¼€è‡ªåŠ¨é‡è¿
- JSONè§£æé”™è¯¯è·³è¿‡
- æ–‡ä»¶å†™å…¥å¼‚å¸¸å¤„ç†

### 5. é…ç½®æ–‡ä»¶
- ä¸²å£å·å¯é…ç½®
- ä¿å­˜ç›®å½•å¯é…ç½®
- æ•°æ®è¿‡æ»¤è§„åˆ™å¯é…ç½®

---

## ğŸ“¦ æ¨èå®ç°æŠ€æœ¯æ ˆ

### Python (æ¨è) â­

**æ ¸å¿ƒåº“**:
```python
import serial           # ä¸²å£é€šä¿¡: pyserial
import json             # JSONè§£æ: å†…ç½®
from datetime import datetime  # æ—¶é—´å¤„ç†: å†…ç½®
import os               # æ–‡ä»¶æ“ä½œ: å†…ç½®
```

**å¯é€‰åº“**:
```python
import matplotlib.pyplot as plt  # æ•°æ®å¯è§†åŒ–
import pandas as pd              # æ•°æ®åˆ†æ
import numpy as np               # æ•°å€¼è®¡ç®—
```

**å®‰è£…å‘½ä»¤**:
```bash
pip install pyserial matplotlib pandas numpy
```

---

## ğŸ¯ æ•°æ®æµç¨‹å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STM32F407  â”‚
â”‚  (ä¼ æ„Ÿå™¨)   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ UART (115200)
       â”‚ æ¯500mså‘é€3æ¡JSON
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         ä¸Šä½æœºç¨‹åº                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  1. ä¸²å£æ¥æ”¶æ•°æ®            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚           â†“                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  2. åˆ¤æ–­æ¶ˆæ¯ç±»å‹            â”‚  â”‚
â”‚  â”‚     - JSON? â†’ è§£æ          â”‚  â”‚
â”‚  â”‚     - æ–‡æœ¬? â†’ æ‰“å°          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚       â†“               â†“           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ NTCæ•°æ® â”‚   â”‚  å…¶ä»–æ¶ˆæ¯    â”‚  â”‚
â”‚  â”‚ æå–    â”‚   â”‚  æ˜¾ç¤º/è®°å½•   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚       â†“                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  3. æ·»åŠ ä¸Šä½æœºæ—¶é—´æˆ³      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚           â†“                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  4. ä¿å­˜åˆ°JSONæ–‡ä»¶        â”‚    â”‚
â”‚  â”‚     ntc_temp_*.json      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ Ctrl+C é€€å‡º
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  5. æ•°æ®åˆ†æ/ç»˜å›¾                 â”‚
â”‚     - è¯»å–JSONæ–‡ä»¶                â”‚
â”‚     - æå–æ—¶é—´å’Œæ¸©åº¦              â”‚
â”‚     - ç»˜åˆ¶æ›²çº¿å›¾                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âœ… éªŒæ”¶æ ‡å‡†

### åŸºæœ¬åŠŸèƒ½ (å¿…é¡»å®ç°):
- [ ] èƒ½æ­£ç¡®æ‰“å¼€ä¸²å£å¹¶æ¥æ”¶æ•°æ®
- [ ] èƒ½åŒºåˆ†JSONæ¶ˆæ¯å’Œæ™®é€šæ–‡æœ¬æ¶ˆæ¯
- [ ] èƒ½æ­£ç¡®è§£æJSONæ ¼å¼çš„ä¼ æ„Ÿå™¨æ•°æ®
- [ ] èƒ½è¯†åˆ«å¹¶æå–NTCæ¸©åº¦æ•°æ®
- [ ] èƒ½æ·»åŠ ä¸Šä½æœºæ—¶é—´æˆ³
- [ ] æ¯æ¬¡è¿è¡Œåˆ›å»ºæ–°çš„JSONæ–‡ä»¶
- [ ] æ–‡ä»¶ååŒ…å«æ—¥æœŸæ—¶é—´æˆ³
- [ ] æŒ‰Ctrl+Cèƒ½æ­£å¸¸é€€å‡ºå¹¶ä¿å­˜æ•°æ®
- [ ] æ§åˆ¶å°èƒ½å®æ—¶æ˜¾ç¤ºæ¥æ”¶åˆ°çš„æ•°æ®

### æ•°æ®è´¨é‡:
- [ ] æ—¶é—´æˆ³ç²¾åº¦è¾¾åˆ°æ¯«ç§’çº§
- [ ] æ¸©åº¦æ•°æ®ä¿ç•™2ä½å°æ•°
- [ ] JSONæ–‡ä»¶æ ¼å¼æ­£ç¡® (å¯è¢«å…¶ä»–ç¨‹åºè¯»å–)
- [ ] æ•°æ®å®Œæ•´æ— ä¸¢å¤±

### ç”¨æˆ·ä½“éªŒ:
- [ ] ç¨‹åºå¯åŠ¨æ˜¾ç¤ºé…ç½®ä¿¡æ¯
- [ ] å®æ—¶æ˜¾ç¤ºæ•°æ®æ¥æ”¶çŠ¶æ€
- [ ] é€€å‡ºæ—¶æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯
- [ ] æ§åˆ¶å°è¾“å‡ºæ¸…æ™°æ˜“è¯»

---

## ğŸ“ ç¤ºä¾‹ä»£ç æ¡†æ¶

```python
"""
STM32F407 æ¸©åº¦æ•°æ®é‡‡é›†ä¸Šä½æœº
åŠŸèƒ½: æ¥æ”¶NTCæ¸©åº¦æ•°æ®å¹¶ä¿å­˜ä¸ºJSONæ–‡ä»¶
"""

import serial
import json
from datetime import datetime
import os

# ========== é…ç½®å‚æ•° ==========
SERIAL_PORT = 'COM3'      # ä¿®æ”¹ä¸ºå®é™…ä¸²å£å·
BAUD_RATE = 115200
SAVE_DIR = './temp_data'  # æ•°æ®ä¿å­˜ç›®å½•

# ========== ä¸»ç¨‹åº ==========
def main():
    # 1. åˆ›å»ºä¿å­˜ç›®å½•
    os.makedirs(SAVE_DIR, exist_ok=True)
    
    # 2. æ‰“å¼€ä¸²å£
    ser = serial.Serial(SERIAL_PORT, BAUD_RATE, timeout=1)
    print(f"ğŸ”Œ ä¸²å£ {SERIAL_PORT} å·²æ‰“å¼€")
    
    # 3. åˆ›å»ºæ•°æ®æ–‡ä»¶
    timestamp = datetime.now().strftime('%Y%m%d_%H%M%S')
    filename = os.path.join(SAVE_DIR, f'ntc_temp_{timestamp}.json')
    print(f"ğŸ“Š æ•°æ®æ–‡ä»¶: {filename}")
    print("=" * 60)
    
    ntc_data_list = []
    
    try:
        while True:
            # 4. æ¥æ”¶æ•°æ®
            line = ser.readline().decode('utf-8', errors='ignore').strip()
            if not line:
                continue
            
            # 5. å¤„ç†JSONæ¶ˆæ¯
            if line.startswith('{') and line.endswith('}'):
                data = json.loads(line)
                
                # 6. æå–NTCæ¸©åº¦æ•°æ®
                if data.get('type') == 'data' and data.get('sensor') == 'NTC':
                    now = datetime.now()
                    record = {
                        'pc_timestamp': now.isoformat(),
                        'pc_time_sec': now.timestamp(),
                        'temperature': data['temp']
                    }
                    ntc_data_list.append(record)
                    print(f"ğŸ“ˆ [{len(ntc_data_list):04d}] {now.strftime('%H:%M:%S')} | Temp: {record['temperature']:.2f}Â°C")
            else:
                # 7. æ‰“å°æ™®é€šæ–‡æœ¬
                print(f"ğŸ’¬ {line}")
    
    except KeyboardInterrupt:
        # 8. ä¿å­˜æ•°æ®
        print(f"\n\nâ¹ï¸  è®°å½•åœæ­¢!")
        print(f"ğŸ“Š å…±è®°å½• {len(ntc_data_list)} æ¡NTCæ¸©åº¦æ•°æ®")
        
        with open(filename, 'w', encoding='utf-8') as f:
            json.dump(ntc_data_list, f, indent=2, ensure_ascii=False)
        
        print(f"âœ… æ•°æ®å·²ä¿å­˜: {filename}")
    
    finally:
        ser.close()
        print("ğŸ”Œ ä¸²å£å·²å…³é—­")

if __name__ == '__main__':
    main()
```

---

## ğŸ“Œ æ³¨æ„äº‹é¡¹

1. **ä¸²å£å·ç¡®è®¤**: 
   - Windows: è®¾å¤‡ç®¡ç†å™¨æŸ¥çœ‹ (COM1, COM3, etc.)
   - Linux: é€šå¸¸ä¸º `/dev/ttyUSB0` æˆ– `/dev/ttyACM0`
   - Mac: é€šå¸¸ä¸º `/dev/cu.usbserial-*`

2. **æ—¶é—´ç²¾åº¦**: 
   - Pythonçš„ `datetime.now()` ç²¾åº¦ä¸ºå¾®ç§’çº§
   - é€‚åˆè®°å½•500msé—´éš”çš„æ•°æ®

3. **æ•°æ®é‡‡æ ·é¢‘ç‡**:
   - STM32å‘é€: 500msé—´éš”
   - é¢„æœŸæ•°æ®é‡: 120æ¡/åˆ†é’Ÿ, 7200æ¡/å°æ—¶

4. **æ–‡ä»¶å¤§å°ä¼°ç®—**:
   - æ¯æ¡è®°å½•çº¦100å­—èŠ‚
   - 1å°æ—¶çº¦700KB
   - 24å°æ—¶çº¦16MB

5. **ç¼–ç é—®é¢˜**:
   - ä½¿ç”¨UTF-8ç¼–ç 
   - `errors='ignore'` é¿å…è§£ç é”™è¯¯

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ­¥éª¤1: å®‰è£…ä¾èµ–
```bash
pip install pyserial
```

### æ­¥éª¤2: ä¿®æ”¹é…ç½®
```python
SERIAL_PORT = 'COM3'  # æ”¹ä¸ºä½ çš„ä¸²å£å·
```

### æ­¥éª¤3: è¿è¡Œç¨‹åº
```bash
python stm32_data_logger.py
```

### æ­¥éª¤4: åœæ­¢è®°å½•
æŒ‰ `Ctrl+C` åœæ­¢å¹¶ä¿å­˜æ•°æ®

### æ­¥éª¤5: æŸ¥çœ‹æ•°æ®
```bash
# æ•°æ®æ–‡ä»¶ä½ç½®
./temp_data/ntc_temp_20251020_143025.json
```

---

## ğŸ“§ è”ç³»ä¸æ”¯æŒ

å¦‚æœ‰é—®é¢˜æˆ–éœ€è¦è¿›ä¸€æ­¥è¯´æ˜,è¯·å‚è€ƒ:
- STM32ä»£ç : `e:\program_C\STM32F407-\Core\Src\freertos.c` (ç¬¬232-234è¡Œ)
- æ•°æ®æ ¼å¼: è§æœ¬æ–‡æ¡£ "æ•°æ®æ ¼å¼è¯´æ˜" ç« èŠ‚

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**åˆ›å»ºæ—¥æœŸ**: 2025-10-20  
**æœ€åæ›´æ–°**: 2025-10-20  
**STM32å›ºä»¶ç‰ˆæœ¬**: åŸºäº freertos.c (æ··åˆæ¨¡å¼)

---

## ğŸ‰ ç¥å¼€å‘é¡ºåˆ©ï¼
